generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Statuses {
  id           Int                             @id @default(autoincrement())
  code         String                          @unique
  name         String
  description  String?
  isActive     Boolean                         @default(true)
  createdAt    DateTime                        @default(now())
  updatedAt    DateTime                        @updatedAt
}

model Actiones {
  id                  Int                                             @id @default(autoincrement())
  code                String                                          @unique
  name                String
  description         String?
  isActive            Boolean                                         @default(true)
  createdAt           DateTime                                        @default(now())
  updatedAt           DateTime                                        @updatedAt
  applicationsHistory FreshLicenseApplicationsFormWorkflowHistories[] @relation("ActionesToWorkflowHistory")
  rolesActionsMapping       RolesActionsMapping[]
}

model States {
  id              Int                                           @id @default(autoincrement())
  name            String                                        @unique
  districts       Districts[]
  addresses       FLAFAddressesAndContactDetails[]
  users           Users[]                                       @relation("StateUsers")
  occupations     FLAFOccupationAndBusiness[]
}

model Districts {
  id              Int                                           @id @default(autoincrement())
  name            String                                        @unique
  stateId         Int
  state           States                                        @relation(fields: [stateId], references: [id])
  addresses       FLAFAddressesAndContactDetails[]
  users           Users[]                                       @relation("DistrictUsers")
  zones           Zones[]
  occupations     FLAFOccupationAndBusiness[]
}

model Zones {
  id         Int                                     @id @default(autoincrement())
  name       String                                  @unique
  districtId Int
  divisions  Divisions[]
  addresses  FLAFAddressesAndContactDetails[]
  users      Users[]                                 @relation("ZoneUsers")
  district   Districts                               @relation(fields: [districtId], references: [id])
}

model Divisions {
  id        Int                                     @id @default(autoincrement())
  name      String                                  @unique
  zoneId    Int
  zone      Zones                                   @relation(fields: [zoneId], references: [id])
  addresses FLAFAddressesAndContactDetails[]
  stations  PoliceStations[]
  users     Users[]                                 @relation("DivisionUsers")
}

model PoliceStations {
  id         Int                                     @id @default(autoincrement())
  name       String                                  @unique
  divisionId Int
  addresses  FLAFAddressesAndContactDetails[]
  division   Divisions                               @relation(fields: [divisionId], references: [id])
  users      Users[]                                 @relation("PoliceStationUsers")
}

model Roles {
  id                         Int                                             @id @default(autoincrement())
  code                       String                                          @unique
  name                       String
  is_active                  Boolean                                         @default(true)
  created_at                 DateTime                                        @default(now())
  updated_at                 DateTime                                        @updatedAt
  dashboard_title            String
  menu_items                 Json?
  permissions                Json?
  can_access_settings        Boolean                                         @default(false)
  can_forward                Boolean                                         @default(false)
  can_re_enquiry             Boolean                                         @default(false)
  can_generate_ground_report Boolean                                         @default(false)
  can_FLAF                   Boolean                                         @default(false)
  can_create_freshLicence    Boolean                                         @default(false)
  workflowHistoryNext        FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowNextRole")
  workflowHistoryPrevious    FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowPreviousRole")
  users                      Users[]
  rolesActionsMapping       RolesActionsMapping[]
}

model RolesActionsMapping {
  id        Int   @id @default(autoincrement())
  roleId    Int
  actionId  Int
  role      Roles @relation(fields: [roleId], references: [id])
  action    Actiones @relation(fields: [actionId], references: [id])
  isActive Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([roleId, actionId])
}

model WeaponTypeMaster {
  id              Int                                                 @id @default(autoincrement())
  name            String                                              @unique
  description     String?
  imageUrl        String?
  licenseDetails  FLAFLicenseDetails[]                                @relation("RequestedWeapons")
}

model Users {
  id                       Int                                             @id @default(autoincrement())
  username                 String
  email                    String?                                         @unique
  password                 String
  createdAt                DateTime                                        @default(now())
  updatedAt                DateTime                                        @updatedAt
  phoneNo                  String?                                         @unique
  roleId                   Int
  policeStationId          Int?
  stateId                  Int?
  districtId               Int?
  zoneId                   Int?
  divisionId               Int?
  actionsFrom              ActionHistories[]                               @relation("ActionFromUser")
  actionsTo                ActionHistories[]                               @relation("ActionToUser")
  flowMaps                 FlowMaps[]
  nextUserInFlows          FlowNextUsers[]                                 @relation("NextUserInFlow")
  workflowHistoryNext      FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowNextUser")
  workflowHistoryPrevious  FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowPreviousUser")
  district                 Districts?                                      @relation("DistrictUsers", fields: [districtId], references: [id])
  division                 Divisions?                                      @relation("DivisionUsers", fields: [divisionId], references: [id])
  policeStation            PoliceStations?                                 @relation("PoliceStationUsers", fields: [policeStationId], references: [id])
  role                     Roles                                           @relation(fields: [roleId], references: [id])
  state                    States?                                         @relation("StateUsers", fields: [stateId], references: [id])
  zone                     Zones?                                          @relation("ZoneUsers", fields: [zoneId], references: [id])
}

model FlowMaps {
  id            Int               @id @default(autoincrement())
  currentUserId Int
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  actions       ActionHistories[]
  currentUser   Users             @relation(fields: [currentUserId], references: [id])
  nextUsers     FlowNextUsers[]
}

model FlowNextUsers {
  id         Int      @id @default(autoincrement())
  flowMapId  Int
  nextUserId Int
  flowMap    FlowMaps @relation(fields: [flowMapId], references: [id])
  nextUser   Users    @relation("NextUserInFlow", fields: [nextUserId], references: [id])
}

model ActionHistories {
  id          Int      @id @default(autoincrement())
  flowMapId   Int
  fromUserId  Int
  toUserId    Int
  actionTaken String
  createdAt   DateTime @default(now())
  flowMap     FlowMaps @relation(fields: [flowMapId], references: [id])
  fromUser    Users    @relation("ActionFromUser", fields: [fromUserId], references: [id])
  toUser      Users    @relation("ActionToUser", fields: [toUserId], references: [id])
}

// start new changes based on the page segregation for fresh license application form
model FreshLicenseApplicationPersonalDetails {
  id                  Int                             @id @default(autoincrement())
  acknowledgementNo   String?                         @unique
  firstName           String
  middleName          String?
  lastName            String
  filledBy            String?
  parentOrSpouseName  String
  sex                 Sex
  placeOfBirth        String?
  dateOfBirth         DateTime?
  dobInWords          String?
  panNumber           String?                         @unique
  aadharNumber        String?                         @unique
  createdAt           DateTime                        @default(now())
  updatedAt           DateTime                        @default(now()) @updatedAt
  @@index([aadharNumber])
  applicationLifecycleStatus ApplicationLifecycleStatus @default(DRAFT)
  presentAddressId    Int? 
  permanentAddressId  Int?
  occupationAndBusinessId Int?
  occupationAndBusiness                         FLAFOccupationAndBusiness?                  @relation(fields: [occupationAndBusinessId], references: [id])
  permanentAddress                              FLAFAddressesAndContactDetails?              @relation("PermanentAddress", fields: [permanentAddressId], references: [id])
  presentAddress                                FLAFAddressesAndContactDetails?              @relation("PresentAddress", fields: [presentAddressId], references: [id])
  fileUploads                                   FLAFFileUploads[]
  biometricData                                 FLAFBiometricDatas?
  licenseDetails                                FLAFLicenseDetails[]
  criminalHistories                            FLAFCriminalHistories[]
  licenseHistories                             FLAFLicenseHistories[]
}
model FLAFAddressesAndContactDetails {
  id                    Int                             @id @default(autoincrement())
  addressLine           String
  stateId               Int
  districtId            Int
  policeStationId       Int
  sinceResiding         DateTime
  divisionId            Int
  zoneId                Int
  district              Districts                       @relation(fields: [districtId], references: [id])
  division              Divisions                       @relation(fields: [divisionId], references: [id])
  policeStation         PoliceStations                  @relation(fields: [policeStationId], references: [id])
  state                 States                          @relation(fields: [stateId], references: [id])
  zone                  Zones                           @relation(fields: [zoneId], references: [id])
  permanentApplications FreshLicenseApplicationPersonalDetails[] @relation("PermanentAddress")
  presentApplications   FreshLicenseApplicationPersonalDetails[] @relation("PresentAddress")
  telephoneOffice       String?
  telephoneResidence    String?
  officeMobileNumber    String?
  alternativeMobile     String?
}
model FLAFOccupationAndBusiness {
  id                   Int                             @id @default(autoincrement())
  occupation           String
  officeAddress        String
  stateId              Int
  districtId           Int
  cropLocation         String?
  areaUnderCultivation Float?
  district             Districts                       @relation(fields: [districtId], references: [id])
  state                States                          @relation(fields: [stateId], references: [id])
  applications         FreshLicenseApplicationPersonalDetails[]
}
model FLAFCriminalHistories {
  id                     Int                           @id @default(autoincrement())
  applicationId          Int 
  application      FreshLicenseApplicationPersonalDetails @relation(fields: [applicationId], references: [id])

  // (a) Convicted
  isConvicted       Boolean   @default(false)
  offence           String?   // e.g. "Theft", "Fraud"
  sentence          String?   // e.g. "2 years imprisonment"
  dateOfSentence    DateTime?

  // (b) Ordered to execute a bond
  isBondExecuted    Boolean   @default(false)
  bondDate          DateTime?
  bondPeriod        String?   // e.g. "6 months"

  // (c) Prohibited under Arms ActMean to you, yeah. Maybe changes in the last night and move. See you can see hello. It won't work in Mail. Can't change. That's it. Touch it. It's making too much noise. Email. 
  isProhibited      Boolean   @default(false)
  prohibitionDate   DateTime?
  prohibitionPeriod String?   // e.g. "5 years"

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}
model FLAFLicenseHistories {
  id                     Int                           @id @default(autoincrement())
  applicationId          Int 
  application      FreshLicenseApplicationPersonalDetails @relation(fields: [applicationId], references: [id])

  // (a) Whether the applicant applied for a licence before
  hasAppliedBefore       Boolean   @default(false)
  dateAppliedFor         DateTime?
  previousAuthorityName  String?
  previousResult         LicenseResult? // Enum: APPROVED / REJECTED / PENDING

  // (b) Whether applicantâ€™s licence was ever suspended/cancelled/revoked
  hasLicenceSuspended    Boolean   @default(false)
  suspensionAuthorityName    String?
  suspensionReason           String?

  // (c) Any family member in possession of an arms licence
  hasFamilyLicence       Boolean   @default(false)
  familyMemberName       String?
  familyLicenceNumber    String?
  familyWeaponsEndorsed  String[]  // Array of weapon names or details

  // (d) Whether the applicant has a safe place for arms/ammunition
  hasSafePlace           Boolean   @default(false)
  safePlaceDetails       String?

  // (e) Whether the applicant has undergone arms training
  hasTraining            Boolean   @default(false)
  trainingDetails        String?

  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
}
model FLAFLicenseDetails {
  id               Int                           @id @default(autoincrement())
  applicationId    Int
  application      FreshLicenseApplicationPersonalDetails @relation(fields: [applicationId], references: [id])

  needForLicense   LicensePurpose?
  armsCategory     ArmsCategory?
  requestedWeapons WeaponTypeMaster[]            @relation("RequestedWeapons")
  areaOfValidity   String?
  
  // 16(b). Description of ammunition
  ammunitionDescription String?
  specialConsiderationReason String?

  // 19(a). Details for an application for licence in Form IV
  licencePlaceArea       String?   // Place/area for which licence is sought

  // 19(b). Specification of wild beasts permitted to be destroyed
  wildBeastsSpecification String?  // As per Wildlife Protection Act details

  createdAt        DateTime                      @default(now())
  updatedAt        DateTime                      @updatedAt
}

model FLAFFileUploads {
  id            Int                           @id @default(autoincrement())
  applicationId Int
  fileType      FileType
  fileUrl       String
  uploadedAt    DateTime                      @default(now())
  fileName      String
  fileSize      Int
  application   FreshLicenseApplicationPersonalDetails @relation(fields: [applicationId], references: [id])
}
model FLAFBiometricDatas {
  id                Int                            @id @default(autoincrement())
  signatureImageUrl String?
  irisScanImageUrl  String?
  photoImageUrl     String?
  applicationId     Int                            @unique
  application       FreshLicenseApplicationPersonalDetails @relation(fields: [applicationId], references: [id])
}

model FreshLicenseApplicationsFormWorkflowHistories {
  id             Int                           @id @default(autoincrement())
  applicationId  Int
  previousUserId Int
  nextUserId     Int
  actionTaken    String
  remarks        String?
  createdAt      DateTime                      @default(now())
  previousRoleId Int?
  nextRoleId     Int?
  actionesId     Int?
  attachments    Json?
  actiones       Actiones?                     @relation("ActionesToWorkflowHistory", fields: [actionesId], references: [id])
  nextRole       Roles?                        @relation("WorkflowNextRole", fields: [nextRoleId], references: [id])
  nextUser       Users                         @relation("WorkflowNextUser", fields: [nextUserId], references: [id])
  previousRole   Roles?                        @relation("WorkflowPreviousRole", fields: [previousRoleId], references: [id])
  previousUser   Users                         @relation("WorkflowPreviousUser", fields: [previousUserId], references: [id])
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum ArmsCategory {
  RESTRICTED
  PERMISSIBLE
}

enum AreaOfUse {
  DISTRICT
  STATE
  INDIA
}

enum previousStatusOfLicence {
  APPROVED
  PENDING
  REJECTED
}

enum FileType {
  AADHAR_CARD
  PAN_CARD
  TRAINING_CERTIFICATE
  OTHER_STATE_LICENSE
  EXISTING_LICENSE
  SAFE_CUSTODY
  MEDICAL_REPORT
  OTHER
}

enum LicensePurpose {
  SELF_PROTECTION
  SPORTS
  HEIRLOOM_POLICY
}
enum ApplicationLifecycleStatus {
  DRAFT
  SUBMITTED
}

enum LicenseResult {
  APPROVED
  REJECTED
  PENDING
}