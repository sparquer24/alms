generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Statuses {
  id           Int                                      @id @default(autoincrement())
  code         String                                   @unique
  name         String
  description  String?
  isActive     Boolean                                  @default(true)
  isStarted    Boolean                                  @default(false)
  createdAt    DateTime                                 @default(now())
  updatedAt    DateTime                                 @updatedAt
  applications FreshLicenseApplicationPersonalDetails[] @relation("ApplicationWorkflowStatus")
}

model Actiones {
  id                  Int                                             @id @default(autoincrement())
  code                String                                          @unique
  name                String
  description         String?
  isActive            Boolean                                         @default(true)
  createdAt           DateTime                                        @default(now())
  updatedAt           DateTime                                        @updatedAt
  applicationsHistory FreshLicenseApplicationsFormWorkflowHistories[] @relation("ActionesToWorkflowHistory")
  rolesActionsMapping RolesActionsMapping[]
}

model States {
  id          Int                              @id @default(autoincrement())
  name        String                           @unique
  districts   Districts[]
  addresses   FLAFAddressesAndContactDetails[]
  occupations FLAFOccupationAndBusiness[]
  users       Users[]                          @relation("StateUsers")
}

model Districts {
  id          Int                              @id @default(autoincrement())
  name        String                           @unique
  stateId     Int
  state       States                           @relation(fields: [stateId], references: [id], onDelete: Cascade)
  addresses   FLAFAddressesAndContactDetails[]
  occupations FLAFOccupationAndBusiness[]
  users       Users[]                          @relation("DistrictUsers")
  zones       Zones[]
}

model Zones {
  id         Int                              @id @default(autoincrement())
  name       String                           @unique
  districtId Int
  divisions  Divisions[]
  addresses  FLAFAddressesAndContactDetails[]
  users      Users[]                          @relation("ZoneUsers")
  district   Districts                        @relation(fields: [districtId], references: [id], onDelete: Cascade)
}

model Divisions {
  id        Int                              @id @default(autoincrement())
  name      String                           @unique
  zoneId    Int
  zone      Zones                            @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  addresses FLAFAddressesAndContactDetails[]
  stations  PoliceStations[]
  users     Users[]                          @relation("DivisionUsers")
}

model PoliceStations {
  id         Int                              @id @default(autoincrement())
  name       String                           @unique
  divisionId Int
  addresses  FLAFAddressesAndContactDetails[]
  division   Divisions                        @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  users      Users[]                          @relation("PoliceStationUsers")
}

model Roles {
  id                         Int                                             @id @default(autoincrement())
  code                       String                                          @unique
  name                       String
  is_active                  Boolean                                         @default(true)
  created_at                 DateTime                                        @default(now())
  updated_at                 DateTime                                        @updatedAt
  dashboard_title            String
  menu_items                 Json?
  permissions                Json?
  can_access_settings        Boolean                                         @default(false)
  can_forward                Boolean                                         @default(false)
  can_re_enquiry             Boolean                                         @default(false)
  can_generate_ground_report Boolean                                         @default(false)
  can_FLAF                   Boolean                                         @default(false)
  can_create_freshLicence    Boolean                                         @default(false)
  workflowHistoryNext        FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowNextRole")
  workflowHistoryPrevious    FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowPreviousRole")
  rolesActionsMapping        RolesActionsMapping[]
  users                      Users[]
}

model RolesActionsMapping {
  id        Int      @id @default(autoincrement())
  roleId    Int
  actionId  Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  action    Actiones @relation(fields: [actionId], references: [id], onDelete: Cascade)
  role      Roles    @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, actionId])
}

model WeaponTypeMaster {
  id             Int                  @id @default(autoincrement())
  name           String               @unique
  description    String?
  imageUrl       String?
  licenseDetails FLAFLicenseDetails[] @relation("RequestedWeapons")
}

model Users {
  id                      Int                                             @id @default(autoincrement())
  username                String
  email                   String?                                         @unique
  password                String
  createdAt               DateTime                                        @default(now())
  updatedAt               DateTime                                        @updatedAt
  phoneNo                 String?                                         @unique
  roleId                  Int
  policeStationId         Int?
  stateId                 Int?
  districtId              Int?
  zoneId                  Int?
  divisionId              Int?
  actionsFrom             ActionHistories[]                               @relation("ActionFromUser")
  actionsTo               ActionHistories[]                               @relation("ActionToUser")
  flowMaps                FlowMaps[]
  nextUserInFlows         FlowNextUsers[]                                 @relation("NextUserInFlow")
  currentApplications     FreshLicenseApplicationPersonalDetails[]        @relation("CurrentApplicationOwner")
  previousApplications    FreshLicenseApplicationPersonalDetails[]        @relation("PreviousApplicationOwner")
  workflowHistoryNext     FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowNextUser")
  workflowHistoryPrevious FreshLicenseApplicationsFormWorkflowHistories[] @relation("WorkflowPreviousUser")
  district                Districts?                                      @relation("DistrictUsers", fields: [districtId], references: [id], onDelete: Cascade)
  division                Divisions?                                      @relation("DivisionUsers", fields: [divisionId], references: [id], onDelete: Cascade)
  policeStation           PoliceStations?                                 @relation("PoliceStationUsers", fields: [policeStationId], references: [id], onDelete: Cascade)
  role                    Roles                                           @relation(fields: [roleId], references: [id], onDelete: Cascade)
  state                   States?                                         @relation("StateUsers", fields: [stateId], references: [id], onDelete: Cascade)
  zone                    Zones?                                          @relation("ZoneUsers", fields: [zoneId], references: [id], onDelete: Cascade)
}

model FlowMaps {
  id            Int               @id @default(autoincrement())
  currentUserId Int
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  actions       ActionHistories[]
  currentUser   Users             @relation(fields: [currentUserId], references: [id], onDelete: Cascade)
  nextUsers     FlowNextUsers[]
}

model FlowNextUsers {
  id         Int      @id @default(autoincrement())
  flowMapId  Int
  nextUserId Int
  flowMap    FlowMaps @relation(fields: [flowMapId], references: [id], onDelete: Cascade)
  nextUser   Users    @relation("NextUserInFlow", fields: [nextUserId], references: [id], onDelete: Cascade)
}

model ActionHistories {
  id          Int      @id @default(autoincrement())
  flowMapId   Int
  fromUserId  Int
  toUserId    Int
  actionTaken String
  createdAt   DateTime @default(now())
  flowMap     FlowMaps @relation(fields: [flowMapId], references: [id], onDelete: Cascade)
  fromUser    Users    @relation("ActionFromUser", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser      Users    @relation("ActionToUser", fields: [toUserId], references: [id], onDelete: Cascade)
}

model FreshLicenseApplicationPersonalDetails {
  id                         Int                             @id @default(autoincrement())
  almsLicenseId              String?
  acknowledgementNo          String?
  firstName                  String
  middleName                 String?
  lastName                   String
  parentOrSpouseName         String
  sex                        Sex
  placeOfBirth               String?
  dateOfBirth                DateTime?
  dobInWords                 String?
  panNumber                  String?
  aadharNumber               String?
  createdAt                  DateTime                        @default(now())
  updatedAt                  DateTime                        @default(now()) @updatedAt
  filledBy                   String?
  occupationAndBusinessId    Int?
  permanentAddressId         Int?
  presentAddressId           Int?
  currentUserId              Int?
  previousUserId             Int?
  workflowStatusId           Int?
  isApproved                Boolean?                       @default(false)                   
  isFLAFGenerated            Boolean?                       @default(false)
  isGroundReportGenerated    Boolean?                       @default(false)
  isPending                  Boolean?                       @default(false)
  isReEnquiry                Boolean?                       @default(false)
  isReEnquiryDone            Boolean?                       @default(false)
  isRejected                 Boolean?                       @default(false)
  isAwareOfLegalConsequences Boolean?                       @default(false)
  isDeclarationAccepted      Boolean?                       @default(false)
  isTermsAccepted            Boolean?                       @default(false)
  isSubmit                   Boolean?                       @default(false)
  biometricData              FLAFBiometricDatas?             @relation("BiometricData")
  criminalHistories          FLAFCriminalHistories[]         @relation("CriminalHistories")
  fileUploads                FLAFFileUploads[]               @relation("FileUploads")
  licenseDetails             FLAFLicenseDetails[]            @relation("LicenseDetails")
  licenseHistories           FLAFLicenseHistories[]          @relation("LicenseHistories")
  currentUser                Users?                          @relation("CurrentApplicationOwner", fields: [currentUserId], references: [id], onDelete: Cascade)
  occupationAndBusiness      FLAFOccupationAndBusiness?      @relation("occupationAndBusinessId", fields: [occupationAndBusinessId], references: [id], onDelete: Cascade)
  permanentAddress           FLAFAddressesAndContactDetails? @relation("PermanentAddress", fields: [permanentAddressId], references: [id], onDelete: Cascade)
  presentAddress             FLAFAddressesAndContactDetails? @relation("PresentAddress", fields: [presentAddressId], references: [id], onDelete: Cascade)
  previousUser               Users?                          @relation("PreviousApplicationOwner", fields: [previousUserId], references: [id], onDelete: Cascade)
  workflowStatus             Statuses?                       @relation("ApplicationWorkflowStatus", fields: [workflowStatusId], references: [id], onDelete: Cascade)

  @@index([aadharNumber])
}

model FLAFAddressesAndContactDetails {
  id                    Int                                      @id @default(autoincrement())
  addressLine           String
  stateId               Int
  districtId            Int
  policeStationId       Int
  sinceResiding         DateTime
  divisionId            Int
  zoneId                Int
  telephoneOffice       String?
  telephoneResidence    String?
  officeMobileNumber    String?
  alternativeMobile     String?
  district              Districts                                @relation(fields: [districtId], references: [id], onDelete: Cascade)
  division              Divisions                                @relation(fields: [divisionId], references: [id], onDelete: Cascade)
  policeStation         PoliceStations                           @relation(fields: [policeStationId], references: [id], onDelete: Cascade)
  state                 States                                   @relation(fields: [stateId], references: [id], onDelete: Cascade)
  zone                  Zones                                    @relation(fields: [zoneId], references: [id], onDelete: Cascade)
  permanentApplications FreshLicenseApplicationPersonalDetails[] @relation("PermanentAddress")
  presentApplications   FreshLicenseApplicationPersonalDetails[] @relation("PresentAddress")
}

model FLAFOccupationAndBusiness {
  id                   Int                                      @id @default(autoincrement())
  occupation           String
  officeAddress        String
  stateId              Int
  districtId           Int
  cropLocation         String?
  areaUnderCultivation Float?
  district             Districts                                @relation(fields: [districtId], references: [id], onDelete: Cascade)
  state                States                                   @relation(fields: [stateId], references: [id], onDelete: Cascade)
  applications         FreshLicenseApplicationPersonalDetails[] @relation("occupationAndBusinessId")
}

model FLAFCriminalHistories {
  id                Int                                    @id @default(autoincrement())
  applicationId     Int
  isConvicted       Boolean                                @default(false)
  isBondExecuted    Boolean                                @default(false)
  bondDate          DateTime?
  bondPeriod        String?
  isProhibited      Boolean                                @default(false)
  prohibitionDate   DateTime?
  prohibitionPeriod String?
  createdAt         DateTime                               @default(now())
  updatedAt         DateTime                               @updatedAt
  firDetails        Json?
  application       FreshLicenseApplicationPersonalDetails @relation("CriminalHistories", fields: [applicationId], references: [id], onDelete: Cascade)
}

model FLAFLicenseHistories {
  id                      Int                                    @id @default(autoincrement())
  applicationId           Int
  hasAppliedBefore        Boolean                                @default(false)
  dateAppliedFor          DateTime?
  previousAuthorityName   String?
  previousResult          LicenseResult?
  hasLicenceSuspended     Boolean                                @default(false)
  suspensionAuthorityName String?
  suspensionReason        String?
  hasFamilyLicence        Boolean                                @default(false)
  familyMemberName        String?
  familyLicenceNumber     String?
  familyWeaponsEndorsed   String[]
  hasSafePlace            Boolean                                @default(false)
  safePlaceDetails        String?
  hasTraining             Boolean                                @default(false)
  trainingDetails         String?
  createdAt               DateTime                               @default(now())
  updatedAt               DateTime                               @updatedAt
  application             FreshLicenseApplicationPersonalDetails @relation("LicenseHistories", fields: [applicationId], references: [id], onDelete: Cascade)
}

model FLAFLicenseDetails {
  id                         Int                                    @id @default(autoincrement())
  applicationId              Int
  needForLicense             LicensePurpose?
  armsCategory               ArmsCategory?
  areaOfValidity             String?
  ammunitionDescription      String?
  specialConsiderationReason String?
  licencePlaceArea           String?
  wildBeastsSpecification    String?
  createdAt                  DateTime                               @default(now())
  updatedAt                  DateTime                               @updatedAt
  application                FreshLicenseApplicationPersonalDetails @relation("LicenseDetails", fields: [applicationId], references: [id], onDelete: Cascade)
  requestedWeapons           WeaponTypeMaster[]                     @relation("RequestedWeapons")
}

model FLAFFileUploads {
  id            Int                                    @id @default(autoincrement())
  applicationId Int
  fileType      FileType
  fileUrl       String
  uploadedAt    DateTime                               @default(now())
  fileName      String
  fileSize      Int
  application   FreshLicenseApplicationPersonalDetails @relation("FileUploads", fields: [applicationId], references: [id], onDelete: Cascade)
}

model FLAFBiometricDatas {
  id                Int                                    @id @default(autoincrement())
  signatureImageUrl String?
  irisScanImageUrl  String?
  photoImageUrl     String?
  applicationId     Int                                    @unique
  application       FreshLicenseApplicationPersonalDetails @relation("BiometricData", fields: [applicationId], references: [id], onDelete: Cascade)
}

model FreshLicenseApplicationsFormWorkflowHistories {
  id             Int       @id @default(autoincrement())
  applicationId  Int
  previousUserId Int
  nextUserId     Int
  actionTaken    String
  remarks        String?
  createdAt      DateTime  @default(now())
  previousRoleId Int?
  nextRoleId     Int?
  actionesId     Int?
  attachments    Json?
  actiones       Actiones? @relation("ActionesToWorkflowHistory", fields: [actionesId], references: [id], onDelete: Cascade)
  nextRole       Roles?    @relation("WorkflowNextRole", fields: [nextRoleId], references: [id], onDelete: Cascade)
  nextUser       Users     @relation("WorkflowNextUser", fields: [nextUserId], references: [id], onDelete: Cascade)
  previousRole   Roles?    @relation("WorkflowPreviousRole", fields: [previousRoleId], references: [id], onDelete: Cascade)
  previousUser   Users     @relation("WorkflowPreviousUser", fields: [previousUserId], references: [id], onDelete: Cascade)
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

enum ArmsCategory {
  RESTRICTED
  PERMISSIBLE
}

enum AreaOfUse {
  DISTRICT
  STATE
  INDIA
}

enum previousStatusOfLicence {
  APPROVED
  PENDING
  REJECTED
}

enum FileType {
  AADHAR_CARD
  PAN_CARD
  TRAINING_CERTIFICATE
  OTHER_STATE_LICENSE
  EXISTING_LICENSE
  SAFE_CUSTODY
  MEDICAL_REPORT
  REJECTED_LICENSE
  CLAIM_DOCS
  OTHER
}

enum LicensePurpose {
  SELF_PROTECTION
  SPORTS
  HEIRLOOM_POLICY
}

enum LicenseResult {
  APPROVED
  REJECTED
  PENDING
}
